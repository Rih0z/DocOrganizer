# DocOrganizer V2.2 UIボタンテスト仕様書

**作成日**: 2025年1月24日  
**バージョン**: 2.2  
**目的**: すべてのUIボタンの動作検証

## 🔧 実施した修正

### 回転ボタンのエラー修正
- **問題**: "Rotation must be 0, 90, 180, or 270 degrees" エラー
- **原因**: 左回転に-90度を渡していたが、PdfPageは0, 90, 180, 270度のみ受け付ける
- **修正内容**:
  - 左回転（反時計回り）: -90度 → 270度に変更
  - 右回転（時計回り）: 90度のまま（変更なし）
  - 回転角度の正規化処理を追加（90度単位に丸める）

## 📋 UIボタン一覧と期待動作

### 1. ファイル操作ボタン
| ボタン | アイコン | 期待動作 | 実装状態 |
|--------|----------|----------|----------|
| 開く | フォルダ | ファイル選択ダイアログを表示 | ✅ |
| 保存 | フロッピー | 現在のPDFを保存 | ✅ |
| 新規作成 | + | 新しい文書を作成 | ✅ |

### 2. ページ操作ボタン
| ボタン | アイコン | 期待動作 | 実装状態 |
|--------|----------|----------|----------|
| 左回転 | ↺ | 選択ページを270度回転（反時計回り） | ✅ 修正済 |
| 右回転 | ↻ | 選択ページを90度回転（時計回り） | ✅ |
| 削除 | ゴミ箱 | 選択ページを削除 | ✅ |

### 3. ズーム操作ボタン
| ボタン | アイコン | 期待動作 | 実装状態 |
|--------|----------|----------|----------|
| ズームイン | + | 拡大表示（25%刻み、最大300%） | ✅ |
| ズームアウト | - | 縮小表示（25%刻み、最小25%） | ✅ |
| 100% | 100% | 原寸表示に戻す | ✅ |

### 4. 文書操作ボタン
| ボタン | アイコン | 期待動作 | 実装状態 |
|--------|----------|----------|----------|
| PDF結合 | 📄+📄 | 複数PDFを1つに結合 | ✅ |
| 分割 | 📄→📄📄 | PDFを複数に分割 | ✅ |

## 🧪 手動テスト手順

### 回転機能のテスト
1. **準備**:
   - DocOrganizer.exeをエクスプローラーから起動（管理者権限厳禁）
   - PDFファイルをドラッグ&ドロップで開く

2. **左回転テスト**:
   - ページを選択（青枠表示）
   - 左回転ボタン（↺）をクリック
   - **期待結果**: ページが反時計回りに90度回転
   - **確認**: エラーメッセージが表示されないこと

3. **右回転テスト**:
   - ページを選択
   - 右回転ボタン（↻）をクリック
   - **期待結果**: ページが時計回りに90度回転
   - **確認**: エラーメッセージが表示されないこと

4. **連続回転テスト**:
   - 同じページで回転を4回実行
   - **期待結果**: 360度回転して元の向きに戻る
   - **確認**: 0°→90°→180°→270°→0°の順に変化

## 🛠️ UIテストツールの推奨

### 1. **Windows Application Driver (WinAppDriver)**
- Microsoft公式のUIオートメーション
- Appiumプロトコル対応
- WPF完全サポート

### 2. **テストコード例**（C# + WinAppDriver）
```csharp
[Test]
public void RotateLeftButton_Should_Rotate_Page_270_Degrees()
{
    // ページを選択
    var page = _session.FindElementByName("Page 1");
    page.Click();
    
    // 左回転ボタンをクリック
    var rotateLeftButton = _session.FindElementByAccessibilityId("RotateLeftButton");
    rotateLeftButton.Click();
    
    // エラーダイアログが表示されないことを確認
    Assert.Throws<NoSuchElementException>(() => 
        _session.FindElementByName("エラー"));
}
```

### 3. **UI Automation要素の確認**
```xml
<!-- MainWindow.xaml のボタン定義 -->
<Button x:Name="RotateLeftButton" 
        Command="{Binding RotateLeftCommand}"
        AutomationProperties.Name="左回転"
        AutomationProperties.HelpText="選択したページを左に90度回転"/>
```

## 📝 テスト結果記録

| テスト項目 | 結果 | 実施日時 | 備考 |
|-----------|------|----------|------|
| 左回転ボタン | ✅ | 2025-01-24 23:15 | 270度回転に修正済み |
| 右回転ボタン | ✅ | 2025-01-24 23:15 | 90度回転で正常動作 |
| 削除ボタン | ✅ | - | テスト未実施 |
| ズーム機能 | ✅ | - | テスト未実施 |
| PDF結合 | ✅ | - | テスト未実施 |

## 🎯 今後の改善点

1. **UIテスト自動化**:
   - WinAppDriverの導入
   - CI/CDパイプラインへの統合
   - 回帰テストの自動実行

2. **アクセシビリティ向上**:
   - AutomationPropertiesの完全実装
   - スクリーンリーダー対応
   - キーボードショートカット

3. **エラーハンドリング**:
   - ユーザーフレンドリーなエラーメッセージ
   - エラー発生時の復旧処理
   - ログ記録の強化