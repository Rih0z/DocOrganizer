# Windows MCPç’°å¢ƒã§ã®EXEç”Ÿæˆä¿®æ­£ã‚³ãƒãƒ³ãƒ‰
# å®Ÿè¡Œç’°å¢ƒ: Windows MCP Server
# å¯¾è±¡ãƒ‘ã‚¹: C:\builds\Standard-image-repo\v2.2-taxdoc-organizer\

## æ®µéš1: è¨ºæ–­ã®ã¿å®Ÿè¡Œï¼ˆå•é¡Œç‰¹å®šï¼‰
PowerShell -ExecutionPolicy Bypass -File "mcp-windows-build-fix.ps1" -DiagnoseOnly

## æ®µéš2: å®Œå…¨ãªä¿®æ­£ãƒ»ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
PowerShell -ExecutionPolicy Bypass -File "mcp-windows-build-fix.ps1"

## æ®µéš3: å¼·åˆ¶ãƒªãƒ“ãƒ«ãƒ‰ï¼ˆå‰å›ã®ãƒ“ãƒ«ãƒ‰ã«å•é¡ŒãŒã‚ã£ãŸå ´åˆï¼‰
PowerShell -ExecutionPolicy Bypass -File "mcp-windows-build-fix.ps1" -Force

## æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆè©³ç´°åˆ†æç”¨ï¼‰
# 1. ç’°å¢ƒç¢ºèª
dotnet --version
dotnet --list-sdks

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ç¢ºèª
dir src\TaxDocOrganizer.UI\*.csproj
type src\TaxDocOrganizer.UI\TaxDocOrganizer.UI.csproj

# 3. è©³ç´°ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°å–å¾—
dotnet clean --configuration Release
dotnet restore --verbosity normal
dotnet build --configuration Release --verbosity detailed > build-log.txt 2>&1
type build-log.txt

# 4. è©³ç´°ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥å®Ÿè¡Œ
dotnet publish src/TaxDocOrganizer.UI -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o release --verbosity detailed > publish-log.txt 2>&1
type publish-log.txt

# 5. EXEç¢ºèª
dir release\*.exe
if exist "release\TaxDocOrganizer.UI.exe" (
    echo âœ… EXE Found
    powershell -c "Get-Item 'release\TaxDocOrganizer.UI.exe' | Select-Object Name,Length,CreationTime,LastWriteTime"
) else (
    echo âŒ EXE Not Found
    dir release\
)

## æœŸå¾…ã•ã‚Œã‚‹æˆåŠŸå‡ºåŠ›
# âœ… EXE found: C:\builds\Standard-image-repo\v2.2-taxdoc-organizer\release\TaxDocOrganizer.UI.exe
# ğŸ“ Size: [XX] MB
# ğŸ“… Created: [æ—¥æ™‚]
# âœ… Executable started successfully (PID: [ç•ªå·])
# âœ… Startup test completed

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
# å•é¡Œ1: .NET SDK not found
# è§£æ±º: .NET 6.0 SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (https://dotnet.microsoft.com/download)

# å•é¡Œ2: Project file not found
# è§£æ±º: æ­£ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹• (cd C:\builds\Standard-image-repo\v2.2-taxdoc-organizer)

# å•é¡Œ3: Build errors
# è§£æ±º: è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèªã—ã€ä¾å­˜é–¢ä¿‚ã‚’ä¿®æ­£

# å•é¡Œ4: Publish fails
# è§£æ±º: RuntimeIdentifierè¨­å®šã¨PublishSingleFileè¨­å®šã‚’ç¢ºèª